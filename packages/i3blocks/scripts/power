#! /usr/bin/env zsh

BATTERY_STATUS=$( battery_status )

ADAPTER_STATUS=$(
  echo "${BATTERY_STATUS}" \
    | sed -n 's/^Adapter: \(.*\)$/\1/p'
)
IS_ANY_BATTERY_CHARGING=$(
  echo "${BATTERY_STATUS}" \
    | sed -n 's/^Charging: \(.*\)$/\1/p'
)
TOTAL_ENERGY_PERCENT=$(
  echo "${BATTERY_STATUS}" \
    | sed -n 's/^Charge: \(.*\)%$/\1/p'
)

if [[ "${TOTAL_ENERGY_PERCENT}" -lt 10 ]]; then
  BATTERY_ICON=''
elif [[ "${TOTAL_ENERGY_PERCENT}" -lt 40 ]]; then
  BATTERY_ICON=''
elif [[ "${TOTAL_ENERGY_PERCENT}" -lt 60 ]]; then
  BATTERY_ICON=''
elif [[ "${TOTAL_ENERGY_PERCENT}" -lt 90 ]]; then
  BATTERY_ICON=''
else
  BATTERY_ICON=''
fi

if [[ "${ADAPTER_STATUS}" = 'on' ]]; then
  if [[ "${IS_ANY_BATTERY_CHARGING}" = 'yes' ]]; then
    echo "<span foreground='#{color/base0A/hex}'> ${BATTERY_ICON}</span> ${TOTAL_ENERGY_PERCENT}%"
  else
    echo "<span foreground='#{color/base0A/hex}'></span> AC"
  fi
else
  if [[ "${TOTAL_ENERGY_PERCENT}" -lt 10 ]]; then
    echo "<span foreground='#{color/alert/hex}'>${BATTERY_ICON} ${TOTAL_ENERGY_PERCENT}%</span>"
    exit 33
  else
    echo "<span foreground='#{color/base0A/hex}'>${BATTERY_ICON}</span> ${TOTAL_ENERGY_PERCENT}%"
  fi
fi
