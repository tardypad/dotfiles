#! /usr/bin/env zsh

MODE="$( bar_status_mode )"

VOLUME_INFO=$(
  amixer get Master \
    | grep \
        --extended-regex \
        --max-count 1 \
        --only-matching '\[[0-9]{1,3}%\] \[(on|off)\]' \
)

echo "${VOLUME_INFO}" | grep --quiet 'on'
IS_VOLUME_MUTED=$?

VOLUME_PERCENT=$(
  echo "${VOLUME_INFO}" \
    | sed --regexp-extended 's/\[([0-9]+)%\].*/\1/'
)

if [[ "${VOLUME_PERCENT}" -lt 50 ]]; then
  VOLUME_ICON=''
else
  VOLUME_ICON=''
fi

if [[ "${IS_VOLUME_MUTED}" -eq 1 ]]; then
  if [ "${MODE}" = 'full' ]; then
    echo "<span foreground='#{color/warning/hex}'> Muted</span>"
  else
    echo "<span foreground='#{color/warning/hex}'></span>"
  fi
else
  if [ "${MODE}" = 'full' ]; then
    echo "<span foreground='#{color/base0A/hex}'>${VOLUME_ICON}</span> ${VOLUME_PERCENT}%"
  else
    echo "<span foreground='#{color/base0A/hex}'>${VOLUME_ICON}</span>"
  fi
fi
