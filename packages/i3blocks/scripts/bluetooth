#! /usr/bin/env zsh

LIGHT_MODE_FILE_PATH="${XDG_RUNTIME_DIR}/i3blocks_light_mode"

# #TODO: take into account multiple connected devices

BLUETOOTH_INFO=$( bluetoothctl info )

# only display something if a device is connected
if ! echo "${BLUETOOTH_INFO}" \
     | grep --quiet 'Connected: yes'; then
  exit 0
fi

BLUETOOTH_DEVICE_ALIAS=$(
  echo "${BLUETOOTH_INFO}" \
    | sed -n 's/.*Alias: \(.*\)/\1/p'
)

if [ ! -f "${LIGHT_MODE_FILE_PATH}" ]; then
  echo "<span foreground='#{color/base0A/hex}'></span> ${BLUETOOTH_DEVICE_ALIAS}"
else
  echo "<span foreground='#{color/base0A/hex}'></span>"
fi
