#! /usr/bin/env zsh

STTY_BACKUP=$( stty -g )

stty -echoctl

START_SECONDS="${SECONDS}"

duration() {
  local dur=$(( SECONDS - START_SECONDS ))

  local dur_sec=$(( dur % 60 ))
  local dur_min=$(( dur / 60 ))

  printf '%02d:%02d' "${dur_min}" "${dur_sec}"
}

TRAPTERM() {
  printf 'zsh: terminated\n'
  stty "${STTY_BACKUP}"
  return $(( 128 + $1 ))
}

TRAPINT() {
  printf "    %s\n" "$( duration )"
  stty "${STTY_BACKUP}"
  exit 0
}

while : ; do
  printf "    %s\r" "$( duration )"
  sleep 0.1
done
