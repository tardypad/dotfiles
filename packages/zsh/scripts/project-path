#!/bin/sh

init_variables() {
  COMMAND=${0##*/}

  TYPE=
  PROJECT=
}

usage() {
  cat <<- EOF
	usage: ${COMMAND} [<options>] <type> [<project>]

	Display a path related to a project

	Options:
	  -h    show this message only

	Types: main repo docs logs
	EOF
}

error() {
  [ -z "$1" ] || echo "${COMMAND}: $1"
  echo "Try '${COMMAND} -h' for more information."
  exit 1
} >&2

get_project_path() {
  case "${TYPE}" in
    main)
      find "$( xdg-user-dir PROJECTS )"/* \
        -type d -prune -name "${PROJECT}"
      ;;
    repo)
      find "$( xdg-user-dir PROJECTS )"/*/* \
        -type d -prune -name "${PROJECT}"
      ;;
    docs)
      find "$( xdg-user-dir PROJECTS_DOCS )"/* \
        -type d -prune -name "${PROJECT}"
      ;;
    logs)
      find "$( xdg-user-dir PROJECTS_LOGS )"/* \
        -type d -prune -name "${PROJECT}"
      ;;
  esac
}

get_type_path() {
  case "${TYPE}" in
    main) xdg-user-dir PROJECTS ;;
    repo) xdg-user-dir PROJECTS ;;
    docs) xdg-user-dir PROJECTS_DOCS ;;
    logs) xdg-user-dir PROJECTS_LOGS ;;
  esac
}

display_path() {
  if [ -n "${PROJECT}" ]; then
    PROJECT_PATH="$( get_project_path )"
  else
    PROJECT_PATH="$( get_type_path )"
  fi

  if [ -z "${PROJECT_PATH}" ]; then
    echo 'No such project path' >&2
    return 1
  fi

  echo "${PROJECT_PATH}"
}

parse_options() {
  while getopts h OPT; do
    case "${OPT}" in
      h) usage; exit 0 ;;
      ?) error ;;
    esac
  done

  shift $(( OPTIND - 1 ))

  TYPE="$1"
  PROJECT="$2"
}

validate_options() {
  if [ -z "${TYPE}" ]; then
    error 'Missing type argument'
  fi

  if [ "${TYPE}" != 'main' ] \
     && [ "${TYPE}" != 'repo' ] \
     && [ "${TYPE}" != 'docs' ] \
     && [ "${TYPE}" != 'logs' ]; then
    error "Invalid type '${TYPE}'"
  fi
}

init_variables
parse_options "$@"
validate_options

display_path
