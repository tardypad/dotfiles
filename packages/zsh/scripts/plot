#!/bin/sh

init_variables() {
  COMMAND=${0##*/}

  DEFAULT_TYPE=line
  DEFAULT_WIDTH=80
  DEFAULT_HEIGHT=25

  JP_OPTIONS=
}

usage() {
  cat <<- EOF
	usage: ${COMMAND} [<options>] [ -- <jp options> ]

	Plot simple data from stdin
	Data must have 1 or 2 columns

	Options:
	  -h                 show this message only
	EOF
}

error() {
  [ -z "$1" ] || echo "${COMMAND}: $1"
  echo "Try '${COMMAND} -h' for more information."
  exit 1
} >&2

plot_data() {
  awk '
    BEGIN { OFS="," }
    /^[0-9.]+$/ { print NR,$1; next; }
    { print $1,$2; }
  ' \
    | jp \
      -input csv \
      -type "${DEFAULT_TYPE}" \
      -width "${DEFAULT_WIDTH}" \
      -height "${DEFAULT_HEIGHT}" \
      ${JP_OPTIONS}
}

parse_options() {
  while getopts h OPT; do
    case "${OPT}" in
      h) usage; exit 0 ;;
      ?) error ;;
    esac
  done

  shift $(( OPTIND )) 2> /dev/null

  JP_OPTIONS="$*"
}

init_variables
parse_options "$@"

plot_data
