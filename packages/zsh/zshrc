# load all individual configs
for conf in "${HOME}/.zsh/config.d/"*.zsh; do
  source "${conf}"
done
unset conf

eval $( dircolors "${HOME}/.dircolors" )

# enable changing directories without typing cd
setopt auto_cd

# disable flow control within ZSH
setopt no_flow_control

# use run-help utility
unalias run-help 2> /dev/null
autoload -Uz run-help

# reuse ssh-agent across ttys
ssh-add -l &>/dev/null
if [ "$?" -eq 2 ]; then
  test -r ~/.cache/ssh-agent && \
  eval "$(<~/.cache/ssh-agent)" >/dev/null

  ssh-add -l &>/dev/null
  if [ "$?" -eq 2 ]; then
    (umask 066; ssh-agent > ~/.cache/ssh-agent)
    eval "$(<~/.cache/ssh-agent)" >/dev/null
  fi
fi

# reload config on interactive shell
# when catching user defined signal USR1
TRAPUSR1() {
  if [[ -o INTERACTIVE ]]; then
    source "${HOME}/.zshrc"
  fi
}

### Fish-like autosuggestions

source /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=fg=10

# Ctrl+Enter accepts and executes suggestion
bindkey '^[[27;5;13~' autosuggest-execute
bindkey -M vicmd '^[[27;5;13~' autosuggest-execute

### Syntax highlighting

# important to source the syntax highlighting at the end
# because it needs all widgets to be already created
source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# define all highlighters
ZSH_HIGHLIGHT_HIGHLIGHTERS=(
  main
  brackets
  pattern
)

# highlight potentially dangerous commands that requires extra attention
ZSH_HIGHLIGHT_PATTERNS=('rm -(rf|fr) *' 'bg=red,fg=black,bold')
ZSH_HIGHLIGHT_PATTERNS+=('rm * -(rf|fr)' 'bg=red,fg=black,bold')

# brackets matching colors
ZSH_HIGHLIGHT_STYLES[bracket-error]='fg=red,bold'
ZSH_HIGHLIGHT_STYLES[cursor-matchingbracket]='fg=white,bold'
ZSH_HIGHLIGHT_STYLES[bracket-level-1]='fg=green'
ZSH_HIGHLIGHT_STYLES[bracket-level-2]='fg=cyan'
ZSH_HIGHLIGHT_STYLES[bracket-level-3]='fg=blue'
ZSH_HIGHLIGHT_STYLES[bracket-level-4]='fg=yellow'
ZSH_HIGHLIGHT_STYLES[bracket-level-5]='fg=magenta'

### Fish-like history substring search

# important to source the history substring search after syntax highlighting
source /usr/share/zsh/plugins/zsh-history-substring-search/zsh-history-substring-search.zsh

# substring history navigation
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down

# colors
HISTORY_SUBSTRING_SEARCH_HIGHLIGHT_FOUND='bg=magenta,fg=black'
HISTORY_SUBSTRING_SEARCH_HIGHLIGHT_NOT_FOUND='bg=red,fg=black'
