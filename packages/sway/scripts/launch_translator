#! /usr/bin/env zsh

typeset -A CODE_LANGUAGE

CODE_LANGUAGE=(
    'af'        'Afrikaans'
    'sq'        'Albanian'
    'am'        'Amharic'
    'ar'        'Arabic'
    'hy'        'Armenian'
    'az'        'Azerbaijani'
    'ba'        'Bashkir'
    'eu'        'Basque'
    'be'        'Belarusian'
    'bn'        'Bengali'
    'bs'        'Bosnian'
    'bg'        'Bulgarian'
    'yue'       'Cantonese'
    'ca'        'Catalan'
    'ceb'       'Cebuano'
    'ny'        'Chichewa'
    'zh-CN'     'Chinese Simplified'
    'zh-TW'     'Chinese Traditional'
    'co'        'Corsican'
    'hr'        'Croatian'
    'cs'        'Czech'
    'da'        'Danish'
    'nl'        'Dutch'
    'mhr'       'Eastern Mari'
    'en'        'English'
    'eo'        'Esperanto'
    'et'        'Estonian'
    'fj'        'Fijian'
    'tl'        'Filipino'
    'fi'        'Finnish'
    'fr'        'French'
    'fy'        'Frisian'
    'gl'        'Galician'
    'ka'        'Georgian'
    'de'        'German'
    'el'        'Greek'
    'gu'        'Gujarati'
    'ht'        'Haitian Creole'
    'ha'        'Hausa'
    'haw'       'Hawaiian'
    'he'        'Hebrew'
    'mrj'       'Hill Mari'
    'hi'        'Hindi'
    'hmn'       'Hmong'
    'mww'       'Hmong Daw'
    'hu'        'Hungarian'
    'is'        'Icelandic'
    'ig'        'Igbo'
    'id'        'Indonesian'
    'ga'        'Irish'
    'it'        'Italian'
    'ja'        'Japanese'
    'jv'        'Javanese'
    'kn'        'Kannada'
    'kk'        'Kazakh'
    'km'        'Khmer'
    'tlh'       'Klingon'
    'tlh-Qaak'  'Klingon (pIqaD)'
    'ko'        'Korean'
    'ku'        'Kurdish'
    'ky'        'Kyrgyz'
    'lo'        'Lao'
    'la'        'Latin'
    'lv'        'Latvian'
    'lt'        'Lithuanian'
    'lb'        'Luxembourgish'
    'mk'        'Macedonian'
    'mg'        'Malagasy'
    'ms'        'Malay'
    'ml'        'Malayalam'
    'mt'        'Maltese'
    'mi'        'Maori'
    'mr'        'Marathi'
    'mn'        'Mongolian'
    'my'        'Myanmar'
    'ne'        'Nepali'
    'no'        'Norwegian'
    'pap'       'Papiamento'
    'ps'        'Pashto'
    'fa'        'Persian'
    'pl'        'Polish'
    'pt'        'Portuguese'
    'pa'        'Punjabi'
    'otq'       'Querétaro Otomi'
    'ro'        'Romanian'
    'ru'        'Russian'
    'sm'        'Samoan'
    'gd'        'Scots Gaelic'
    'sr-Cyrl'   'Serbian (Cyrillic)'
    'sr-Latn'   'Serbian (Latin)'
    'st'        'Sesotho'
    'sn'        'Shona'
    'sd'        'Sindhi'
    'si'        'Sinhala'
    'sk'        'Slovak'
    'sl'        'Slovenian'
    'so'        'Somali'
    'es'        'Spanish'
    'su'        'Sundanese'
    'sw'        'Swahili'
    'sv'        'Swedish'
    'ty'        'Tahitian'
    'tg'        'Tajik'
    'ta'        'Tamil'
    'tt'        'Tatar'
    'te'        'Telugu'
    'th'        'Thai'
    'to'        'Tongan'
    'tr'        'Turkish'
    'udm'       'Udmurt'
    'uk'        'Ukrainian'
    'ur'        'Urdu'
    'uz'        'Uzbek'
    'vi'        'Vietnamese'
    'cy'        'Welsh'
    'xh'        'Xhosa'
    'yi'        'Yiddish'
    'yo'        'Yoruba'
    'yua'       'Yucatec Maya'
    'zu'        'Zulu'
)


display_item() {
  local code="$1"

  local language=$CODE_LANGUAGE[${CODE}]
  local filler_length=$((
    COLUMNS - ${#code} - ${#language} - 8
  ))
  local filler="${(l.$filler_length.. .)}"

  echo "${language}${filler}${code}"
}


code_from_item() {
  local item="$1"

  echo "${item}" \
    | rev \
    | cut --delimiter ' ' --fields 1 \
    | rev
}


choose_language() {
  local prompt="$1"

  echo "${ITEMS}" \
  | sort \
  | fzf --reverse \
        --no-multi \
        --margin 1,2,0,2 \
        --prompt "${prompt} " \
        --color info:8
}


ITEMS=$(
  for CODE in "${(@k)CODE_LANGUAGE}"; do
    display_item "${CODE}"
  done
)


SOURCE_ITEM=$( choose_language 'source' )
[[ -n "${SOURCE_ITEM}" ]] || exit

TARGET_ITEM=$( choose_language 'target' )
[[ -n "${TARGET_ITEM}" ]] || exit


SOURCE_LANGUAGE_CODE=$( code_from_item "${SOURCE_ITEM}" )
TARGET_LANGUAGE_CODE=$( code_from_item "${TARGET_ITEM}" )


swaymsg -t command \
  exec "termite --title ' Translator' --exec 'zsh -c \"translate_shell ${SOURCE_LANGUAGE_CODE} ${TARGET_LANGUAGE_CODE}\"'"
