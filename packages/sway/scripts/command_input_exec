#!/bin/sh

init_variables() {
  COMMAND=${0##*/}

  PROMPT=
  FORMAT='%s'
  USER_INPUT=
}

usage() {
  cat <<- EOF
	usage: ${COMMAND} [<options>]

	Sway command input script

	Options:
	  -F  FORMAT  sway command to be executed
                %s occurences are replaced by user input
	  -h          show this message only
	  -P  PROMPT  display before user input
	EOF
}

error() {
  [ -z "$1" ] || echo "${COMMAND}: $1"
  printf "Try '%s -h' for more information.\n" "${COMMAND}"
  exit 1
} >&2

run() {
  printf '%s' "${PROMPT}"
  read -r USER_INPUT

  SWAY_COMMAND="$(
    echo "${FORMAT}" \
      | sed "s/%s/${USER_INPUT}/g"
  )"

  swaymsg -q ${SWAY_COMMAND}
}

parse_options() {
  while getopts F:hP: OPT; do
    case "${OPT}" in
      F) FORMAT="${OPTARG}" ;;
      h) usage; exit 0 ;;
      P) PROMPT="${OPTARG}" ;;
      ?) error ;;
    esac
  done

  shift $(( OPTIND - 1 ))
}

init_variables
parse_options "$@"

run
