#! /usr/bin/env zsh

PATH_COMMANDS=$(
  echo -n "${PATH}" \
    | xargs --delimiter=: -I{} \
      -- find -L {} \
      -maxdepth 1 -mindepth 1 \
      -type f -executable \
      -printf '%P\n' \
      2> /dev/null
)

ZSH_VERSION=$( zsh --version | cut --fields 2 --delimiter ' ' )
ZSH_HELPDIR="/usr/share/zsh/${ZSH_VERSION}/help"
ZSH_HELP_TOPICS=$( ls "${ZSH_HELPDIR}" )

MAN_TOPICS=$(
  find -L /usr/share/man/man* -type f -printf '%P\n' \
    | sed -r 's#(.*)\.[^\.]*\.gz#\1#'
)

TOPIC=$(
  {
    echo "${PATH_COMMANDS}";
    echo "${ZSH_HELP_TOPICS}";
    echo "${MAN_TOPICS}";
  } \
  | sort -u \
  | fzf --reverse \
        --no-multi \
        --margin 1,2,0,2 \
        --prompt 'topic ' \
        --color info:{color/background/number} \
)

[[ -n "${TOPIC}" ]] || exit

swaymsg exec \
  "termite \
   --title 'ÔÅö Help' \
   --exec 'tmux new-session \"rtfm ${TOPIC}\"'"
