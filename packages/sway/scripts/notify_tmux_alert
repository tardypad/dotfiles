#!/usr/bin/env zsh

# #HACK: when triggered from another session, the hook is run multiple times
# this should preferably  be fixed on the tmux side
makoctl dismiss --all

TYPE="$1"
SOCKET_NAME="$2"
SESSION_ID="$3"
SESSION_NAME="$4"
WINDOW_ID="$5"
WINDOW_NAME="$6"

MESSAGE="socket: ${SOCKET_NAME}\n"
MESSAGE+="session: ${SESSION_NAME}\n"
MESSAGE+="window: ${WINDOW_NAME}"

notify-send \
  --category 'notice' \
  "Tmux ${TYPE} detected" \
  "${MESSAGE}"

WINDOW_MARK=_tmux_alert
WINDOW_MARK+="_${SOCKET_NAME}"
WINDOW_MARK+="_${SESSION_ID}"
WINDOW_MARK+="_${WINDOW_ID}"

swaymsg "[con_mark=\"${WINDOW_MARK}\"]" urgent enable
