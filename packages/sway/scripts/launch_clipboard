#! /usr/bin/env zsh

typeset -A LIST

LIST=(
  'Bullshit generator'   '24/7 viral metrics'
  'Cool'                 '(⌐■_■)'
  'Copyright'            '©'
  'Degree'               '°'
  'Euro'                 '€'
  'Flipping table'       '(╯°□°)╯︵┻━┻'
  'Flipping text'        '(╯°□°)╯︵ʇxǝʇ'
  'Full Width'           'T E X T'
  'Happy Gary'           'ᕕ(ᐛ)ᕗ'
  'Look of Disapproval'  'ಠ_ಠ'
  'Mocking SpongeBob'    'tExT'
  'Registered'           '®'
  'Shrug'                '¯\_(ツ)_/¯'
  'Trademark'            '™'
  'Upside Down'          'ʇxǝʇ'
)

display_item() {
  local name="$1"

  # #FIXME: there is a length calculation issue for character such as ツ
  # which are counted as 1 but are displayed on 2 cells
  local item=$LIST[${NAME}]
  local filler_length=$((
    COLUMNS - ${#name} - ${#item} - 8
  ))
  local filler="${(l.$filler_length.. .)}"

  echo "${name}${filler}${item}"
}


TYPE=$(
  for NAME in "${(@k)LIST}"; do
    display_item "${NAME}"
  done \
    | sort \
    | fzf --reverse \
          --no-multi \
          --margin 1,2,0,2 \
          --prompt 'copy ' \
          --color info:8
)

[[ -n "${TYPE}" ]] || exit


# Text transformations
if [[ "${TYPE}" =~ 'Mocking SpongeBob*' ]]; then
  echo 'TyPe ThE tExT tO sTyLe'
  swaymsg clipboard "$( text_style mocking_spongebob )"
  exit
fi

if [[ "${TYPE}" =~ 'Upside Down*' ]]; then
  echo 'ǝlʎʇs oʇ ʇxǝʇ ǝɥʇ ǝdʎʇ'
  swaymsg clipboard "$( text_style upside_down )"
  exit
fi

if [[ "${TYPE}" =~ 'Full Width*' ]]; then
  echo 'T Y P E   T H E   T E X T   T O   S T Y L E'
  swaymsg clipboard "$( text_style full_width )"
  exit
fi

# Special case
if [[ "${TYPE}" =~ 'Flipping text*' ]]; then
  echo 'Type text to ǝlʎʇs'
  swaymsg clipboard "(╯°□°)╯︵$( text_style upside_down )"
  exit
fi

# Special case
if [[ "${TYPE}" =~ 'Bullshit generator*' ]]; then
    swaymsg clipboard "$( bullshit_generator )"
  exit
fi

# #FIXME: if there ever are 2 items where one full name is the beginning of another
# then the loop search will need to start with items of longer length
# to match the proper item
for NAME in "${(@k)LIST}"; do
  if [[ "${TYPE}" =~ "${NAME}*" ]]; then
    swaymsg clipboard  "$LIST[${NAME}]"
    exit
  fi
done
