#! /usr/bin/env zsh

PASS_PREFIX=${PASSWORD_STORE_DIR-~/.password-store}
PASSWORD_FILES=( "$PASS_PREFIX"/**/*.gpg )
PASSWORD_FILES=( "${PASSWORD_FILES[@]#"$PASS_PREFIX"/}" )
PASSWORD_FILES=( "${PASSWORD_FILES[@]%.gpg}" )

NAME=$(
  printf '%s\n' "${PASSWORD_FILES[@]}" \
    | sort \
    | fzf --reverse \
          --no-multi \
          --margin 1,2,0,2 \
          --prompt 'password ' \
          --color info:{color/background/number}
)

[[ -n "${NAME}" ]] || exit

# #FIXME: not sure why I need to use nohup there
# Without it, the password gets cleared immediately after exiting the launcher
# even if it works fine when running launch_password manually in a terminal...
nohup pass show --clip "${NAME}" &> /dev/null
