#compdef backup

_sources() {
  local sources=(
    laptop
    phone
    server
  )

  compadd "$@" $sources
}

_targets() {
  local targets=(
    hdd1
    hdd2
    server
  )

  compadd "$@" $targets
}

_items() {
  local source=$words[CURRENT-2] target=$words[CURRENT-1] items=()

  if [ $source = 'laptop' ]; then
    if [[ $target = hdd* ]]; then
      items=(
        bookmarks
        books
        contacts
        notes
        todo
        videos
      )
    elif [ $target = 'server' ]; then
      items=(
        bookmarks
        notes
        time_tracker_logs
        todo
      )
    fi
  elif [ $source = 'phone' ]; then
      items=(
        messages
        pictures
        videos
      )
  elif [ $source = 'server' ]; then
    if [[ $target = hdd* ]]; then
      items=(
        bookmarks
        notes
        packages
        repositories
        todo
      )
    fi
  fi

  compadd "$@" $items
}

_arguments \
  '-c[only check differences]:()' \
  '1:source:_sources' \
  '2:target:_targets' \
  '3:item:_items'
