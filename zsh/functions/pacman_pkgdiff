local package_name="$1"

local package_version=$(
  pacman --query "${package_name}" \
    | cut --field 2 --delimiter ' '
)

# need double --check argument to show modified files
local package_modified_files=( $(
  pacman --query --check --check "${package_name}" \
    | grep '^backup file:' \
    | cut --field 4 --delimiter ' ' \
    | uniq
) )

# if it happens we have packages with many modified files
# we'll better extract first a single time instead of doing for each file
for package_modified_file in ${package_modified_files}; do
  echo "${package_modified_file}"
  tar --extract --to-stdout \
    --file /var/cache/pacman/pkg/${package_name}-${package_version}-*.pkg.tar.xz \
    "${package_modified_file/\//}" \
    2> /dev/null \
  | diff - "${package_modified_file}"
  echo
done
